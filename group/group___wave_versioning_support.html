
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Group WaveVersioningSupport &#8212; MIES Igor (main) Release_2.1_20200723-235-g4651bebc documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File list" href="../filelist.html" />
    <link rel="prev" title="Group LabnotebookQueryFunctions" href="group___labnotebook_query_functions.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../filelist.html" title="File list"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="group___labnotebook_query_functions.html" title="Group LabnotebookQueryFunctions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MIES Igor (main) Release_2.1_20200723-235-g4651bebc documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../grouplist.html" accesskey="U">Group list</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="group-waveversioningsupport">
<span id="id1"></span><h1>Group WaveVersioningSupport<a class="headerlink" href="#group-waveversioningsupport" title="Permalink to this headline">¶</a></h1>
<dl class="group">
<dt>
<span class="target" id="group___wave_versioning_support"></span><em>group</em> <code class="sig-name descname">WaveVersioningSupport</code></dt>
<dd><p>The wave getter functions always return an existing wave. This can result in problems if the layout of the wave changes.</p>
<p>Layout in this context means:<ul class="simple">
<li><p>Sizes of all dimensions</p></li>
<li><p>Labels of all dimensions</p></li>
<li><p>Wave data type</p></li>
<li><p>Prefilled wave content or wave note</p></li>
</ul>
</p>
<p>This also means that the name and location of the wave does <em>not</em> influence the wave version. Use <a class="reference internal" href="#group___wave_versioning_support_1ga677057601df492f62d924a538eac1afc"><span class="std std-ref">UpgradeWaveLocationAndGetIt()</span></a> if you need to move the wave. The main reason is that for being able to query the wave version you already need to know where it is.</p>
<p>In order to enable smooth upgrades between old and new wave layouts the following code pattern can be used: <div class="highlight-igorpro notranslate"><div class="highlight"><pre><span></span><span class="kr">Function</span>/<span class="kt">Wave</span> GetMyWave(panelTitle)
    <span class="kt">string</span> panelTitle

    <span class="kt">DFREF</span> dfr = GetMyPath(panelTitle)
    <span class="kt">variable</span> versionOfNewWave = 2

    <span class="kt">Wave</span>/Z/SDFR=dfr wv = myWave

    <span class="k">if</span>(ExistsWithCorrectLayoutVersion(wv, versionOfNewWave))
        <span class="k">return</span> wv
    <span class="k">elseif</span>(<span class="nf">WaveExists</span>(wv)) <span class="c1">// handle upgrade</span>
        <span class="k">if</span>(WaveVersionIsAtLeast(wv, 1)) <span class="c1">// 1-&gt;2</span>
            <span class="nc">Redimension</span>/D wv
        <span class="k">else</span> <span class="c1">// no-version-&gt;2</span>
            <span class="c1">// change the required dimensions and leave all others untouched with -1</span>
            <span class="c1">// the extended dimensions are initialized with zero</span>
            <span class="nc">Redimension</span>/D/N=(10, -1, -1, -1) wv
        <span class="k">endif</span>
    <span class="k">else</span>
        <span class="nc">Make</span>/N=(10, 2) dfr:myWave/<span class="kt">Wave</span>=wv
    <span class="kr">end</span>

    SetWaveVersion(wv, versionOfNewWave)

    <span class="k">return</span> wv
<span class="kr">End</span>
</pre></div>
</div>
</p>
<p>Now everytime the layout of <code class="docutils literal notranslate"><span class="pre">myWave</span></code> changes, raise <code class="docutils literal notranslate"><span class="pre">versionOfNewWave</span></code> by 1 and add a new <code class="docutils literal notranslate"><span class="pre">WaveVersionIsAtLeast</span></code> branch. When <code class="docutils literal notranslate"><span class="pre">GetMyWave</span></code> is called the first time, the wave is redimensioned or rebuilt as double wave depending on the current version, and on successive calls the wave is returned as is.</p>
<p>Hints:<ul class="simple">
<li><p>Wave layout versioning is <em>mandatory</em> if you change the layout of the wave</p></li>
<li><p>Wave layout versions start with 1 and are integers</p></li>
<li><p>Rule of thumb: Raise the version if you change anything in or below the <code class="docutils literal notranslate"><span class="pre">Make</span></code> line</p></li>
<li><p>Wave versioning needs a special wave note style, see <a class="reference internal" href="../file/_m_i_e_s___utilities_8ipf.html#_m_i_e_s___utilities_8ipf_1a5bb9c63f5cddda48388e3e5544ba7513"><span class="std std-ref">GetNumberFromWaveNote</span></a> </p></li>
</ul>
</p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Functions</p>
<dl class="function">
<dt id="_CPPv430ExistsWithCorrectLayoutVersion10WaveOrNull8variable">
<span id="_CPPv330ExistsWithCorrectLayoutVersion10WaveOrNull8variable"></span><span id="_CPPv230ExistsWithCorrectLayoutVersion10WaveOrNull8variable"></span><span id="ExistsWithCorrectLayoutVersion__WaveOrNull.variable"></span><span class="target" id="group___wave_versioning_support_1ga6855576336de95961a286c6adfbab288"></span><em class="property">static</em> variable <code class="sig-name descname">ExistsWithCorrectLayoutVersion</code><span class="sig-paren">(</span>WaveOrNull <em>wv</em>, variable <em>versionOfNewWave</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Check if wv exists and has the correct version. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv420WaveVersionIsAtLeast10WaveOrNull8variable">
<span id="_CPPv320WaveVersionIsAtLeast10WaveOrNull8variable"></span><span id="_CPPv220WaveVersionIsAtLeast10WaveOrNull8variable"></span><span id="WaveVersionIsAtLeast__WaveOrNull.variable"></span><span class="target" id="group___wave_versioning_support_1gaed4ce3b532835da1a8b4d2b3ccae443e"></span><em class="property">static</em> variable <code class="sig-name descname">WaveVersionIsAtLeast</code><span class="sig-paren">(</span>WaveOrNull <em>wv</em>, variable <em>existingVersion</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Check if the given wave’s version is equal or larger than the given version, if version is not set false is returned. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv420WaveVersionIsSmaller10WaveOrNull8variable">
<span id="_CPPv320WaveVersionIsSmaller10WaveOrNull8variable"></span><span id="_CPPv220WaveVersionIsSmaller10WaveOrNull8variable"></span><span id="WaveVersionIsSmaller__WaveOrNull.variable"></span><span class="target" id="group___wave_versioning_support_1gad594ea44aa39c25df70e7efe3a48c091"></span><em class="property">static</em> variable <code class="sig-name descname">WaveVersionIsSmaller</code><span class="sig-paren">(</span>WaveOrNull <em>wv</em>, variable <em>existingVersion</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Check if the given wave’s version is smaller than the given version, if version is not set true is returned. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv414GetWaveVersion10WaveOrNull">
<span id="_CPPv314GetWaveVersion10WaveOrNull"></span><span id="_CPPv214GetWaveVersion10WaveOrNull"></span><span id="GetWaveVersion__WaveOrNull"></span><span class="target" id="group___wave_versioning_support_1gabf2dcd5f72f5e21c82ca805739a0beb4"></span>variable <code class="sig-name descname">GetWaveVersion</code><span class="sig-paren">(</span>WaveOrNull <em>wv</em><span class="sig-paren">)</span><br /></dt>
<dd><p>return the Version of the Wave, returns NaN if no version was set </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv414SetWaveVersion4wave8variable">
<span id="_CPPv314SetWaveVersion4wave8variable"></span><span id="_CPPv214SetWaveVersion4wave8variable"></span><span id="SetWaveVersion__wave.variable"></span><span class="target" id="group___wave_versioning_support_1ga65c056aed5f84f15e4066ea9b63d2088"></span><em class="property">static</em> variable <code class="sig-name descname">SetWaveVersion</code><span class="sig-paren">(</span>wave <em>wv</em>, variable <em>val</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Set the wave layout version of wave. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv418IsValidWaveVersion8variable">
<span id="_CPPv318IsValidWaveVersion8variable"></span><span id="_CPPv218IsValidWaveVersion8variable"></span><span id="IsValidWaveVersion__variable"></span><span class="target" id="group___wave_versioning_support_1ga77ad61982a8945382436bc5fe2f18205"></span><em class="property">static</em> variable <code class="sig-name descname">IsValidWaveVersion</code><span class="sig-paren">(</span>variable <em>value</em><span class="sig-paren">)</span><br /></dt>
<dd><p>A valid wave version is a positive non-zero integer. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv430ClearWaveNoteExceptWaveVersion4wave">
<span id="_CPPv330ClearWaveNoteExceptWaveVersion4wave"></span><span id="_CPPv230ClearWaveNoteExceptWaveVersion4wave"></span><span id="ClearWaveNoteExceptWaveVersion__wave"></span><span class="target" id="group___wave_versioning_support_1ga6913c7a4d9472ebdf9243661f9909d80"></span>variable <code class="sig-name descname">ClearWaveNoteExceptWaveVersion</code><span class="sig-paren">(</span>wave <em>wv</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Clear the wave note but keep any valid wave version. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv425UpgradeDataFolderLocation6string6string">
<span id="_CPPv325UpgradeDataFolderLocation6string6string"></span><span id="_CPPv225UpgradeDataFolderLocation6string6string"></span><span id="UpgradeDataFolderLocation__string.string"></span><span class="target" id="group___wave_versioning_support_1gad3f8c18d6f8a19f3286dd0059ec8a4d3"></span>dfr <code class="sig-name descname">UpgradeDataFolderLocation</code><span class="sig-paren">(</span>string <em>oldFolder</em>, string <em>newFolder</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Move/Rename a datafolder across different locations. </p>
<p>Both parameters must be absolute datafolder locations. Cases where both exist are also handled gracefully.</p>
<p><div class="highlight-igorpro notranslate"><div class="highlight"><pre><span></span><span class="kr">Function</span>/DF GetMyFolder()
    <span class="k">return</span> UpgradeDataFolderLocation(<span class="s">&quot;root:old&quot;</span>, <span class="s">&quot;root:new&quot;</span>)
<span class="kr">End</span>
</pre></div>
</div>
</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>DFREF to the <code class="docutils literal notranslate"><span class="pre">newFolder</span></code> with the contents of <code class="docutils literal notranslate"><span class="pre">oldFolder</span></code> </p>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv427UpgradeWaveLocationAndGetItP15WaveLocationMod">
<span id="_CPPv327UpgradeWaveLocationAndGetItP15WaveLocationMod"></span><span id="_CPPv227UpgradeWaveLocationAndGetItP15WaveLocationMod"></span><span id="UpgradeWaveLocationAndGetIt__WaveLocationModP"></span><span class="target" id="group___wave_versioning_support_1ga677057601df492f62d924a538eac1afc"></span>wave <code class="sig-name descname">UpgradeWaveLocationAndGetIt</code><span class="sig-paren">(</span><a class="reference internal" href="../file/_m_i_e_s___structures_8ipf.html#_CPPv415WaveLocationMod" title="WaveLocationMod">WaveLocationMod</a> *<em>p</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Rename/Move a wave to a new location. </p>
<p>Valid transformations (and all combinations of them):<ul class="simple">
<li><p>Moving into a new datafolder</p></li>
<li><p>Renaming to a new name</p></li>
<li><p>Nothing</p></li>
</ul>
</p>
<p>The function is idempotent (i.e. it can be called also on already relocated waves). Cases where new == old are also handled gracefully.</p>
<p><div class="highlight-igorpro notranslate"><div class="highlight"><pre><span></span><span class="kr">Function</span>/<span class="kt">WAVE</span> GetMyWave(panelTitle)
    <span class="kt">string</span> panelTitle

    <span class="kt">variable</span> versionOfNewWave = 1
    <span class="kt">string</span> newName = <span class="s">&quot;newAndNiceName&quot;</span>
    <span class="kt">DFREF</span> newDFR = GetNewAndFancyFolder(panelTitle)

    <span class="kt">STRUCT</span> WaveLocationMod p
    p.dfr     = $(GetSomeFolder(panelTitle) + <span class="s">&quot;:oldSubFolder&quot;</span>)
    p.newDFR  = newDFR
    p.name    = <span class="s">&quot;oldAndUglyName&quot;</span>
    p.newName = newName

    <span class="kt">WAVE</span>/Z wv = UpgradeWaveLocationAndGetIt(p)

    <span class="k">if</span>(ExistsWithCorrectLayoutVersion(wv, versionOfNewWave))
        <span class="k">return</span> wv
    <span class="k">elseif</span>(<span class="nf">WaveExists</span>(wv))
        <span class="c1">// handle upgrade</span>
    <span class="k">else</span>
        <span class="nc">Make</span>/N=(10, 2) newDFR:newName/<span class="kt">Wave</span>=wv
    <span class="kr">end</span>

    SetWaveVersion(wv, versionOfNewWave)

    <span class="k">return</span> wv
<span class="kr">End</span>
</pre></div>
</div>
</p>
<p><dl class="simple">
<dt><strong>Return</strong></dt><dd><p>wave reference to the wave in the new location, an invalid one if the wave does not exist at the specified former location </p>
</dd>
</dl>
</p>
</dd></dl>

</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reportingbugs.html">Bug reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes.html">Release notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../grouplist.html">Group list</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="group___analysis_function_parameter_helpers.html">Group AnalysisFunctionParameterHelpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="group___background_functions.html">Group BackgroundFunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="group___labnotebook_query_functions.html">Group LabnotebookQueryFunctions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Group WaveVersioningSupport</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structlist.html">Struct list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespacelist.html">Namespace list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CalculateTPLikePropsFromSweep.html">CalculateTPLikePropsFromSweep Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SweepFormula.html">The Sweep Formula Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IPNWB/index.html">Igor Pro module for reading and writing NeurodataWithoutBorder files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TPAnalysis_algorithm.html">Testpulse Analysis Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../asyncframework.html">Async Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ZeroMQ-XOP-Readme.html">ZeroMQ XOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../labnotebook-docs.html">Labnotebook documentation for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epoch_information.html">Epoch Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mies-concepts.html">Important MIES concepts for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daq-details.html">DAQ details</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="group___labnotebook_query_functions.html"
                        title="previous chapter">Group LabnotebookQueryFunctions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../filelist.html"
                        title="next chapter">File list</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/group/group___wave_versioning_support.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../filelist.html" title="File list"
             >next</a> |</li>
        <li class="right" >
          <a href="group___labnotebook_query_functions.html" title="Group LabnotebookQueryFunctions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MIES Igor (main) Release_2.1_20200723-235-g4651bebc documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../grouplist.html" >Group list</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0.
    </div>
  </body>
</html>